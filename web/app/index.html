<!doctype html>
<html lang="en" xmlns:ng="http://angularjs.org/" ng-app="slides">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>React</title>
</head>

<body ng-controller="SlideCtrl" slideshow ng-cloak>

    <slide title="WebSockets!" class="react">
        <div class="center">
<!--             <img src="img/connectivity.png" width="256" height="256"> -->
            <img src="img/connectivity-orange.png">
        



        <p class="left">http://{{host}}</p><p class="right">by: Chris Boden</p>
        </div>
    </slide>

    <slide title="What are WebSockets?">



        <center><blockquote>WebSockets are a web technology providing full-duplex communications channels over a single TCP connection.</blockquote></center>
    </slide>
    
    <slide title="How does this work?">
    
        <center>
            <img src="img/holding-door.jpg">
        </center>
    </slide>
    
    <slide style="background-color: #D3DFD1"><center><img src="img/wat.jpg"></center></slide>
    
    <slide title="Recognizing a WebSocket request">
        <center><img src="img/magnifyingglass.gif"></center>
    </slide>

    <slide title="WebSocket RFC6455" class="protocol">



         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-------+-+-------------+-------------------------------+
        |F|R|R|R| opcode|M| Payload len |    Extended payload length    |
        |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
        |N|V|V|V|       |S|             |   (if payload len==126/127)   |
        | |1|2|3|       |K|             |                               |
        +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
        |     Extended payload length continued, if payload len == 127  |
        + - - - - - - - - - - - - - - - +-------------------------------+
        |                               |Masking-key, if MASK set to 1  |
        +-------------------------------+-------------------------------+
        | Masking-key (continued)       |          Payload Data         |
        +-------------------------------- - - - - - - - - - - - - - - - +
        :                     Payload Data continued ...                :
        + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
        |                     Payload Data continued ...                |
        +---------------------------------------------------------------+
    </slide>

    <slide title="Example: draw something"><div ng-controller="slideDraw"><canvas id="imageView" width="800" height="585" drawing></canvas></div></slide>

    <slide title="Ratchet">





        <center><h3>(<a href="http://socketo.me" target="_blank">Ratchet</a> needs a logo)</h3></center>
    </slide>
    
    <slide title="Ratchet is...">
        <ul>
            <li>WebSockets in PHP</li>
            <li>PSR-0 -- on <a href="http://packagist.org/packages/cboden/Ratchet" target="_blank">Packagist</a> -- on <a href="https://github.com/cboden/Ratchet" target="_blank">GitHub</a> -- <a href="https://travis-ci.org/cboden/Ratchet" target="_blank">unit tested</a></li>
            <li>Built on top of React (asynchronous, interoperable)</li>
            <li><a href="http://socketo.me/reports/ab" target="_blank">RFC6455 compliant</a></li>
            <li>Made of loosely coupled components (middlewares)</li>
        </ul>
    </slide>

    <slide title="WebSocket event API"><ul>
            <li>onOpen</li>

            <li>onMessage</li>

            <li>onClose</li>

            <li>onError</li>
        </ul>
    </slide>

    <slide title="The Interfaces" class="smallerCode">
<pre class="code-only">&lt;php
namespace Ratchet;

interface ComponentInterface {
    function onOpen(ConnectionInterface $conn);

    function onMessage(ConnectionInterface $from, $msg);

    function onClose(ConnectionInterface $conn);

    function onError(ConnectionInterface $conn, \Exception $e);
}


interface ConnectionInterface {
    function send($data);

    function close();
}
    </pre></slide>

    <slide title="JavaScript sample" class="smallerCode"><pre class="code-only brush:JavaScript">var conn = new WebSocket('ws://{{host}}/chat');

conn.onopen = function(e) {
    console.log('Connection established');

    var me = prompt('What is your name?', ''); // What is your quest?
    conn.send('Hello everyone! I am ' + me);
}

conn.onmessage = function(e) {
    console.log('ws-msg: ' + e.data);
}

conn.onclose = function(e) {
    console.warn('Connection closed');
//    setTimeout(function() {
//        conn = new WebSocket('ws://{{host}}/chat');
//    }, 5000);
}

conn.onerror = function(e) {
    console.error('Damnit!');
}</pre></slide>

    <slide title="PHP...but first" class="smallerCode">
    
    <div class="half right"><img src="img/composer.png"></div><div class="half left"><pre class="code-only">{
    "require": {
        "cboden/Ratchet": "0.3.*"
    }
}</pre></div><div class="clear"></div>


    <p class="smaller terminal"><span class="generated">$</span> composer install</p>
    </slide>

    <slide class="smallerCode"><pre class="code-only highlight: [5]; brush: php">&lt;?php
use Ratchet\MessageComponentInterface;
use Ratchet\ConnectionInterface;

class Chat implements MessageComponentInterface {
    protected $conns;
    public function __construct() {
        $this->conns = new \SplObjectStorage;
    }

    function onOpen(ConnectionInterface $conn) {
        $this->conns->attach($conn);
    }

    function onMessage(ConnectionInterface $conn, $msg) {
        foreach ($this->conns as $to) // Sorry for excluding the "{"
            if ($conn != $to)         // Ran out of vertical space
                $to->send($msg);      // Or how about "Pythonic"?
    }

    function onClose(ConnectionInterface $conn) {
        $this->conns->detach($conn);
    }

    function onError(ConnectionInterface $conn, \Exception $e) { }
}</pre></slide>

    <slide title="Execution">
        <pre class="code-only brush: php">&lt;?php
// Ratchet/0.3
$app = new Ratchet\App('hostname', 8080, '0.0.0.0');
$app->route('/chat', new Chat);
$app->run();
</pre>


        App.php <a href="https://github.com/cboden/Ratchet/blob/master/src/Ratchet/App.php" target="_blank">source</a>
    </slide>

    <slide title="Ratchet's decoration" class="protocol">


                    +------------------------------------------------------+
                    | I/O                                                  |
                    |                                                      |
                    |    +-------------------------------------------------+
                    |    | HTTP                                            |
                    |    |                                                 |
                    |    |    +--------------------------------------------+
                    |    |    | Router                                     |
                    |    |    |                                            |
                    |    |    |    +---------------------------------------+
                    |    |    |    | WebSocket                             |
                    |    |    |    |                                       |
                    |    |    |    |    +----------------------------------+
                    |    |    |    |    | *middleware* (WAMP, Logger)      |
                    |    |    |    |    |                                  |
                    |    |    |    |    |    +-----------------------------+
                    |    |    |    |    |    | Your App                    |
                    |    |    |    |    |    |                             |
                    |    |    |    |    |    |                             |
                    |    |    |    |    |    |                             |
                    |    |    |    |    |    |                             |
                    |    |    |    |    |    |                             |
                    +----+----+----+----+----+-----------------------------+
    </slide>
    
    <slide title="Included"><ul>
        <li>IoServer</li><li>FlashPolicy</li><li>EchoServer</li><li>IpBlackList</li><li>HttpServer</li><li>OriginCheck</li><li>Router</li><li>SessionProvider</li><li>WsServer</li><li>WampServer</li>
    </ul></slide>
    
    <slide title="WAMP (not what you think!)"><ul><li>JSON based protocol (human readable)</li>
            <li>The Pub/Sub and RPC patterns</li>
            <li>Middleware included in Ratchet</li>
            <li>Official Javascript library</li>
        </ul>
        <center><a href="http://wamp.ws"><img src="img/wamp_logo.png"></a></center>
    </slide>

    <slide><ol start="0" class="smaller"><li>Welcome</li>
        <li>Prefix</li>
        <li>Call</li>
        <li>Call Result</li>
        <li>Call Error</li>
        <li>Subscribe</li>
        <li>Unsubscribe</li>
        <li>Publish</li>
        <li>Event</li></ol></slide>

    <slide title="Publish/Subscribe pattern" class="protocol">




            |\
            | \
            |  \
            |   +---------------------------------------------------------+
            |   |                            |                            |
            |   |                            |    Topic 1                 |
            |   |                            |                            |
            |   |                            |----------------------------|
            |   |                            |                            |
            |   |    WebSocket Connection    |    Topic 2                 |
            |   |                            |                            |
            |   |                            |----------------------------| 
            |   |                            |                            |
            |   |                            |    Topic 3                 |
            |   |                            |                            |
            |   +---------------------------------------------------------+
            |  /
            | /
            |/
    </slide>

    <slide title="RPC pattern (and promises)" class="protocol">







              _  _
             /_\/_\                                             :) Fulfilled 
     +=======\_\/_/=======+                                    +-------------
     |        //\\\------+|                                   /
     |       //  ||to you||   (time passing)                 /
     |        |  |+------+|--------------------------------->
     |        |  |        |   Do not open until Christmas    \
     |        |  |        |                                   \
     +====================+                                    +-------------
                                                                :(  Rejected

    </slide>

    <slide class="smallerCode"><pre class="code-only brush: php;">&lt;?php use Ratchet\ConnectionInterface as Conn;

class BasicPubSub implements Ratchet\Wamp\WampServerInterface {
    public function onPublish(Conn $conn, $topic, $event, array $exclude = array(), array $eligible = array()) {
        $topic->broadcast($event);
    }

    public function onCall(Conn $conn, $id, $topic, array $params) {
        $conn->callError($id, $topic, 'RPC not supported');
    }

    public function onOpen(Conn $conn) {
    }

    public function onClose(Conn $conn) {
    }

    public function onSubscribe(Conn $conn, $topic) {
    }

    public function onUnSubscribe(Conn $conn, $topic) {
    }

    public function onError(Conn $conn, \Exception $e) {
    }
}</pre></slide>

    <slide title="AutobahnJS" class="smallerCode">
    <pre class="code-only brush: jscript">
var conn = new ab.Session(
    'ws://' + window.location.host, 
    function(sessId, v, srvId) {
        console.log('Sess established to ' + srvId);

        conn.subscribe('wamp-demo', function(topic, data) {
            console.log('msg from ' + topic + ':');
            console.log(data);
        });
    }, function(code) {
        console.warm('WAMP session closed with code: ' + code);
    }, {
        'skipSubprotocolCheck': true
    }
); // Stop copy/paste here

conn.publish('wamp-demo', 'Hello demo peeps!');

conn.close();
</pre>
    </slide>
    
    <slide title="STOMP">
        <ul><li>Another text-based protocol</li>
        <li>Not (yet) supported by Ratchet</li>
        <li>Implemented in React</li>
        <li>Pub/Sub, Transactions, wire meta</li>
        </ul>
    </slide>

    <slide title="WebSocket Browser Support">




        <center><img src="img/ws-support.png"></center>
    </slide>
    
    <slide>    
        <center><img src="img/browsers.png"></center>
    </slide>
    
    <slide title="WebSocket gotcha's"><ul>
            <li>Supporting IE: 7, 8, 9</li>
            <li>iOS &lt; 7 buffers like nobody's business</li>
            <li>Beware aggressive proxies</li>
            <li>Horizontally scaling is harder than sync stacks</li>
            <li>Race conditions <del>may</del> will happen</li>
            <li>1 process to bring them all together - 1 error to ruin them all</li>
    </ul></slide>
    
    <slide title="Supporting &quot;Browsers&quot; with Flash">



        <p class="left" style="margin-left: 40px">Pros</p><p class="right" style="padding-right: 280px">Cons</p>

        <ul class="left"><li>Very easy to implement</li><li>True polyfill</li><li>They're IE users anyway</li></ul><ul class="right" style="padding-right: 40px;"><li>It's Flash...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</li><li>Up to 3 second connect</li><li>Port blocked by proxies</li></ul>
    </slide>
    
    <slide title="Reverse Proxying (+SSL)">
        <ul>
            <li>React/Ratchet will not support SSL for server</li>
            
            <li>Nginx</li>
            <li>HAProxy</li>
            <li>STunnel</li>
        </ul>
    </slide>

    <slide title="Inter-Process Communication">
    
    
    
    
        <center>
            <img src="img/zmq.gif">
        </center>
    </slide>
    
    <slide title="Hello, Async? Yes, this is sync." class="smallerCode">

Client:    
        <pre class="code-only">$context = new ZMQContext();
$socket = $context->getSocket(ZMQ::SOCKET_PUSH, 'myPersistentId');
$socket->connect("tcp://localhost:5555");
$socket->send($_POST['msg']);</pre>
Server:
        <pre class="code-only">/* Previous WebSocket code */
$context = new React\ZMQ\Context($loop);
$pull = $context->getSocket(ZMQ::SOCKET_PULL);
$pull->bind('tcp://127.0.0.1:5555');
$pull->on('message', array($ratchetClass, 'injMethod'));
$loop->run();
</pre>
    </slide>
    
    <slide>
    
    
        <center><img src="img/haters.jpg"></center>
    </slide>

    <slide title="Going Polyglot">
        <ul><li>Python - AutobahnPython</li>
        <li>Node - SockJS | Faye</li>
        <li>Ruby - EventMachine | Faye</li>
        <li>Erlang - Cowboy</li>
        <li>Go - Gorilla</li></ul>
    </slide>
    
    <slide title="Speaking with other things">
        <ul><li>ZeroMQ</li>
        <li>DNode</li>
        <li>RabbitMQ</li>
        </ul>
    </slide>
    
    <slide>
    
    
        <center>
            <blockquote class="twitter-tweet" lang="en"><p>Knock knock&#10;Race condition&#10;Who&#39;s there?</p>&mdash; I Am Devloper (@iamdevloper) <a href="https://twitter.com/iamdevloper/statuses/399991896862638081">November 11, 2013</a></blockquote>
        </center>
    </slide>

    <slide title="Develop with caution">
        <center><img src="img/evented-programming.gif"></center>

        <p class="smaller terminal generated">PHP Fatal error:  Call to a member function detach() on a non-object in /socketo.me/src/Ratchet/Examples/Tutorial/ChatRoom.php on line 170</p>
    </slide>
    
<!--
    <slide title="Security">
        <ul><li>CSRF</li>
        <li>Same Origin policy</li>
        </ul>
    </slide>
-->
    
    <slide title="The future?">
        <ul>
            <li>HHVM?</li>
            <li>Async session management</li>
            <li>Socket.IO and/or SockJS support</li>
            <li>Binary message support</li>
        </ul>
    </slide>

    <slide title="Questions?">


        <ul>
            <li><a href="https://joind.in/10437" target="_blank">https://joind.in/10437</a></li>
            <li><a href="https://twitter.com/boden_c" target="_blank">@boden_c</a></li>
            <li><a href="http://reactphp.org" target="_blank">reactphp.org</a></li>
            <li><a href="http://socketo.me" target="_blank">socketo.me</a></li>
            <li><a href="https://github.com/cboden/presentr" target="_blank">Presentr</a></li>
        </ul></slide>

    <div id="slideCounter" ng-controller="OnlineCtrl">
                         <span title="Live slideshow status">{{status}}</span> 
        &nbsp; -- &nbsp; <span title="Slide number/total">{{currentSlide}} / {{slideCount}}</span> 
        &nbsp; -- &nbsp; <span title="Peers on this slide/overall">{{peers}}/<span>{{connected}}</span></span>
    </div>

<!--
    <div id="slideCounter">
                         <span ng-controller="OnlineCtrl" title="Live slideshow status">{{status}}</span> 
        &nbsp; -- &nbsp; <span title="Slide number/total">{{currentSlide}} / {{slideCount}}</span> 
        &nbsp; -- &nbsp; <span title="Peers on this slide/overall">{{peers}}/<span ng-controller="OnlineCtrl">{{peers}}</span></span>
    </div>
-->
</body>
    <script>
        var addPath = '';
        window.define = function(factory) {
            try{ delete window.define; } catch(e){ window.define = void 0; } // IE
            window.when = factory();
        };
        window.define.amd = {};
    </script>

<!--     <script src="scripts/jquery-1.9.1.js"></script> -->
    <script src="bower_components/when/when.js"></script>
    <script src="bower_components/autobahnjs/autobahn/autobahn.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/angular-ui-router/release/angular-ui-router.js"></script>
    <script src="bower_components/SyntaxHighlighter/scripts/XRegExp.js"></script>
    <script src="bower_components/SyntaxHighlighter/scripts/shCore.js"></script>
    <script src="bower_components/SyntaxHighlighter/scripts/shBrushJScript.js"></script>
    <script src="bower_components/SyntaxHighlighter/scripts/shBrushXml.js"></script>
    <script src="bower_components/SyntaxHighlighter/scripts/shBrushPhp.js"></script>
    <script async src="http://platform.twitter.com/widgets.js" charset="utf-8"></script>
    
    <link rel="stylesheet" href="styles/fonts.css" type="text/css">
    <link rel="stylesheet" href="bower_components/SyntaxHighlighter/styles/shCore.css" type="text/css">
    <link rel="stylesheet" href="bower_components/SyntaxHighlighter/styles/shThemeDefault.css" type="text/css">
    <link rel="stylesheet" href="styles/presentation.css" type="text/css">

    <script src="scripts/slide.js"></script>
    <script src="scripts/slide-directives.js"></script>
</html>
